# music-blog
Простой блок на стэке Flask+SQLAlchemy+PostgreSQL.

Имеются модели для пользователя, публикаций и тэгов к публикациям. Предусмотрена работа
в dev-среде (встроенный во flask сервер), а так же сборка в контейнере.


## Установка и запуск

### 1. Через менеджер пакетов [Poetry](https://python-poetry.org/).

```shell
pip install poetry
poetry install
poetry shell
music_blog db upgrade
music_blog demo
music_blog run
```
После установки poetry в корне репозитория запускаете `poetry install`, которые создаст
виртуальное окружение, установит необходимые зависимости (возможны проблемы с установкой 
psycopg2, которому для сборки требуется gcc и libpq-dev; альтернативой может послужить 
psycopg2-binary)
Затем внутри окружения необходимо запустить команды для создания/обновления структуры БД,
генерации демо-публикаций и запуска веб-сервера

### 2. Запуск в контейнере.

```shell
cp .env-sample .env
docker-compose build
docker-compose up
```
Определите значения в переменных `.env` и запускайте сборку. В `docker-compose` запускаются два сервиса: PostgreSQL и собственно приложение. Контейнер с 
приложением собирается на базе `python:3.9-slim` и представляет собой связку
Flask-uWSGI-Nginx. Nginx и uWSGI работают через сокет, их работой управляет `supervisor`.

### 3. Кастомизация

Приложение позволяет определить ряд параметров
`MUSIC_BLOG_DSN` - БД приложения
`MUSIC_BLOG_UPLOADS` - папка для загрузки изображений
`MUSIC_BLOG_SECRET_KEY` - csrf / шифрование сессий
`MUSIC_BLOG_POSTS_PER_PAGE` - количество постов на странице


## Работа блога.

### Основной функционал

На данный момент реализована страница всех статей с пагинацией и 
фильтром по тэгу; страница отдельной статьи, на ней есть рекомендации
на случайные статьи того же автора. Работает регистрация и авторизация.

### Демо-данные

Параметры генерации на данный момент жестко заданы в коде. 
`music_blog demo` - создаст 3-х пользователей с паролем '123', 10 тэгов и 
60 публикаций.
